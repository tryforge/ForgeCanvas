"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),__1=require("../.."),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$addFrame",description:"Adds a frame to the GIF.",version:"1.2.0",brackets:!0,unwrap:!0,args:[{name:"gif",description:"Name of the GIF.",type:forgescript_1.ArgType.String,required:!1,rest:!1},{name:"frame",description:"Frame source.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"options",description:"Frame options.",type:forgescript_1.ArgType.Json,required:!1,rest:!1},{name:"speed",description:"Frame rgb quantization speed.",type:forgescript_1.ArgType.Number,check:s=>s>=1&&s<=30,required:!1,rest:!1}],async execute(s,[g,a,r,d]){const o=g?s.gifManager?.getEncoder(g):s.gifManager?.lastCurrentEncoder;if(!o)return this.customError("No gif");let t;if(a.startsWith("rgba://")){const[e,i]=(0,__1.parseArgs)(a,"rgba://",2),[n,f]=e.split("x").map(Number);t=gifsx_1.Frame.fromRgba(n,f,Uint8Array.from(i.split(",").map(Number)),d)}else if(a.startsWith("hex://")){const[e,i]=(0,__1.parseArgs)(a,"hex://",2),[n,f]=e.split("x").map(Number);t=gifsx_1.Frame.fromHex(n,f,i.split(",").map(m=>m.trim()),d)}else if(a.startsWith("rgb://")){const[e,i]=(0,__1.parseArgs)(a,"rgb://",2),[n,f]=e.split("x").map(Number);t=gifsx_1.Frame.fromRgb(n,f,Uint8Array.from(i.split(",").map(Number)),d)}else if(a.startsWith("indexed://")){const[e,i]=(0,__1.parseArgs)(a,"indexed://",2),[n,f]=e.split("x").map(Number);t=gifsx_1.Frame.fromIndexedPixels(n,f,Uint8Array.from(i.split(",").map(Number)))}else if(a.startsWith("images://")){const e=s.imageManager?.get(a.slice(9));if(!e)return this.customError("No image");t=await(0,__1.loadFrame)(e,d)}else if(a.startsWith("frame://")){const e=s.gifManager?.getFrame(a.slice(8));if(!e)return this.customError("No frame");t=e}else if(a.startsWith("canvas://")){const e=s.canvasManager?.get(a.slice(9));if(!e)return this.customError("No canvas");t=gifsx_1.Frame.fromRgba(e.width,e.height,Uint8Array.from(e.ctx.getImageData(0,0,e.width,e.height).data),d)}else t=await(0,__1.loadFrame)(a);return t?(r&&(typeof r.delay=="number"&&(t.delay=r.delay),r.dispose&&gifsx_1.DisposalMethod[r.dispose]&&(t.dispose=r.dispose),typeof r.transparent=="number"&&(t.transparent=r.transparent),typeof r.needsUserInput=="boolean"&&(t.needsUserInput=r.needsUserInput),typeof r.top=="number"&&(t.top=r.top),typeof r.left=="number"&&(t.left=r.left),typeof r.interlaced=="boolean"&&(t.interlaced=r.interlaced),Array.isArray(r.palette)&&t.setPalette(Uint8Array.from(r.palette))),o.addFrame(t),this.success()):this.customError("Invalid frame")}});
